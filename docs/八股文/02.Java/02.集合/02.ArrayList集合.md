---
title: ArrayListé›†åˆ
date: 2022-06-28 23:44:59
permalink: /pages/8084b7/
categories:
  - å…«è‚¡æ–‡
  - Java
  - é›†åˆ
tags:
  - 
---

## ArrayListé›†åˆ

### ArrayListç®€å•ä»‹ç»
é›†åˆæ¡†æ¶çš„ä½“ç³»
     ä¸¤å¤§é›†åˆCollectionï¼ŒMapæ¥å£ï¼Œé‚£ä¹ˆå¯¹äºCollectionæ¥å£æ¥è¯´ä¸‹é¢è¿˜æœ‰ä¸¤ä¸ªå­æ¥å£Listï¼ŒSetã€‚å¯¹äºArrayListé›†åˆåˆæ˜¯Listæ¥å£çš„å®ç°ç±»ã€‚è¿™å…³äºä¸€ä¸ªç»§æ‰¿çš„å…³ç³»ï¼Œç®€å•äº†è§£ä¸€ä¸‹ï¼Œå¯åˆ«å¼„æ··äº†ğŸ˜
* ArrayListçš„ä¼˜ç‚¹
    ArrayListåº•å±‚æ˜¯æ•°ç»„å®ç°ï¼ŒåŒæ—¶åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯è¿ç»­çš„ï¼ˆç©ºé—´ï¼‰ï¼Œå¹¶è®°ä¸‹ç´¢å¼•ä¸º0çš„å†…å­˜åœ°å€ã€‚
    ä¸€æ—¦æˆ‘ä»¬çŸ¥é“äº†å†…å­˜åœ°å€å°±å¯ä»¥å¿«é€Ÿæ‰¾åˆ°å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)ï¼›   
    ä¼—æ‰€å‘¨çŸ¥æ•°ç»„ç”¨ä¸€äº›åä¸ºç´¢å¼•çš„æ•°å­—æ¥æ ‡è¯†æ¯é¡¹æ•°æ®åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œé‚£å¤§å®¶ä¹ŸçŸ¥é“ç´¢å¼•ä»0å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ•°ç»„ä¸­çš„ç´¢å¼•å¿«é€Ÿçš„è®¿é—®å…ƒç´ ã€‚è¿™å°±æ˜¯ArrayListé›†åˆæŸ¥æ‰¾å…ƒç´ å¿«çš„ä¼˜ç‚¹ã€‚

* ArrayListçš„ç¼ºç‚¹
ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ArrayListåº•å±‚æ˜¯æ•°ç»„å®ç°ï¼ŒåŒæ—¶åœ¨å†…å­˜ä¸­ä¹Ÿæ˜¯è¿ç»­çš„ï¼ˆç©ºé—´ï¼‰å¢åŠ åˆ é™¤æ“ä½œï¼š

1. æˆ‘ä»¬æƒ³æŠŠä¸€ä¸ªå€¼æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼Œé‚£è¿™æ ·åé¢çš„å…ƒç´ å°±è¦ä¸€ä¸ªä¸ªç§»åŠ¨è…¾å‡ºä½ç½®ï¼Œé€ æˆæ—¶é—´ä¸Šçš„æµªè´¹ã€‚å½“ç„¶å¦‚æœè¦æ’å…¥æœ€åä½ç½®ï¼Œé‚£åªè¦ä¸€éƒ¨æ“ä½œå³å¯è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ã€‚
2.  å¦‚æœæˆ‘ä»¬è¦åˆ é™¤æŸä¸€ä¸ªå…ƒç´ çš„è¯ï¼ŒåŒæ ·çš„æ“ä½œï¼Œå½“ä½ åˆ é™¤åï¼Œåé¢çš„è¦è‡ªåŠ¨è¡¥ä½ã€‚å…¶æ—¶é—´ä¸Šä¹Ÿä¼šé€ æˆæµªè´¹ã€‚
3. å¦‚æ­¤å¯çŸ¥ï¼ŒArrayListçš„ç¼ºç‚¹ï¼Œå½“åˆ é™¤å¢åŠ å…ƒç´ æ—¶æ•ˆç‡æ¯”è¾ƒä½ï¼Œå½“ç„¶å½“å’±ä»¬å¢åŠ çš„æ—¶å€™è¿˜ç‰µæ‰¯åˆ°äº†æ‰©å®¹ï¼Œé›ªä¸ŠåŠ éœœå¯¼è‡´æ›´æ…¢ã€‚

### ArrayListåº•å±‚
::: tip æ€»ç»“
ArrayListä¸­ç»´æŠ¤ä¸€ä¸ªObjectç±»å‹çš„æ•°ç»„Object [] elementData (æºç å¯çœ‹åˆ°)

å½“æˆ‘ä»¬å»åˆ›å»ºArrayListå¯¹è±¡çš„æ—¶å€™ï¼Œä¸æŒ‡å®šå¤§å°çš„è¯ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤çš„æ„é€ å™¨ï¼ˆæ— å‚æ„é€ ï¼‰ï¼Œé‚£åˆå§‹çš„elementDataå®¹é‡ä¸º0ï¼Œç¬¬1æ¬¡å»æ·»åŠ ã€‚æ‰©å®¹10ï¼Œå†å¾€åæ·»åŠ ï¼Œåˆ™æ‰©å®¹1.5å€ã€‚

å½“æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æœ‰å‚æ„é€ å™¨å»æŒ‡å®šåˆå§‹å¤§å°ï¼Œå¦‚æœéœ€è¦æ‰©å®¹ï¼Œåˆ™æ‰©å®¹1.5å€ã€‚
:::

### æºç è§£æ

* Addæ–¹æ³•æºç 
~~~java
public boolean add(E e) {
        ensureCapacityInternal(size + 1);  // Increments modCount!!
        elementData[size++] = e;
        return true;
    }
~~~
debugè¿›å…¥addæ–¹æ³•ååŒ…å«æ‰©å®¹ï¼Œèµ‹å€¼çš„æ“ä½œ
ensureCapacityInternal(size+1)è¿™ä¸ªæ–¹æ³•å°±æ˜¯å…ˆç¡®å®šæ˜¯å¦è¦æ‰©å®¹ï¼Œé‡Œé¢åšäº†å¾ˆå¤šå·¥ä½œã€‚
elementData[size+1] =e; ä¸ºæ•°ç»„èµ‹å€¼ã€‚

1. ensureCapacityInternalæºç 
~~~java
private static int calculateCapacity(Object[] elementData, int minCapacity) {
        if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
            return Math.max(DEFAULT_CAPACITY, minCapacity);
        }
        return minCapacity;
    }
~~~
 if(elementData==DEFAULTCAPACITY_EMPTY_ELEMENTDATA) åˆ¤æ–­elementDataæ˜¯å¦æ˜¯ç©ºæ•°ç»„ï¼Œå¦‚æœæ˜¯çš„è¯è¿›å…¥åˆ¤æ–­æ‰§è¡Œ Math.max(); è·å–ä¸€ä¸ªæœ€å¤§å€¼ï¼Œä¸Šå›¾ä¸­Math.max()æ–¹æ³•ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯10ï¼Œç¬¬äºŒä¸ªæ˜¯1ï¼Œé‚£å¿…ç„¶å°†minCapacityæœ€å°å®¹é‡èµ‹å€¼10ï¼›
 **ensureExplicitCapacityï¼ˆminCapacityï¼‰**:æ‰©å®¹æ“ä½œ

2. ensureExplicitCapacityæºç 
~~~java
 private void ensureExplicitCapacity(int minCapacity) {
        modCount++;

        // overflow-conscious code
        if (minCapacity - elementData.length > 0)
            grow(minCapacity);
    }
~~~
modCount++ï¼š è®°å½•é›†åˆä¿®æ”¹çš„æ¬¡æ•°ã€‚

if(minCapacity-elementData.length>0)ï¼šå¦‚æœéœ€è¦çš„æœ€å°å®¹é‡å‡å»æœ¬èº«æ•°ç»„çš„å®¹é‡å¤§äº0ï¼Œé‚£å°±è¯´æ˜æœ¬èº«æ•°ç»„è¾¾ä¸åˆ°æˆ‘ç»™å®šçš„æœ€å°å®¹é‡å€¼ï¼Œé‚£å°±éœ€è¦è¿›å…¥åˆ¤æ–­æ‰§è¡Œgrowæ–¹æ³• è¿›è¡Œæ‰©å®¹ã€‚

3. growæºç 
~~~java
private void grow(int minCapacity) {
        // overflow-conscious code
        int oldCapacity = elementData.length;
        int newCapacity = oldCapacity + (oldCapacity >> 1);
        if (newCapacity - minCapacity < 0)
            newCapacity = minCapacity;
        if (newCapacity - MAX_ARRAY_SIZE > 0)
            newCapacity = hugeCapacity(minCapacity);
        // minCapacity is usually close to size, so this is a win:
        elementData = Arrays.copyOf(elementData, newCapacity);
    }
~~~
int oldCapacity = elementData.lengthï¼šèµ‹å€¼æ“ä½œ
int newCapacity = oldCapacity + (oldCapacity >> 1); çœŸæ­£æ‰©å®¹çš„æ ¸å¿ƒæ­¥éª¤ï¼ŒoldCapacity >> 1å³ä½ç§»1ã€‚è¯´æ˜æ‰©å¤§1.5å€
æ³¨æ„: å‰ä¸¤æ­¥ å’±å’±ä»¬ç¬¬ä¸€æ¬¡è¿›è¡Œaddæ“ä½œï¼Œé‚£ä¹ˆelementData.length æ˜¯0 ï¼Œé‚£åˆ°ç¬¬äºŒæ­¥å³ä½ç§»æ‰©å¤§1.5å€ï¼Œ0+0/2=0ã€‚åˆ°æœ€åè¿˜æ˜¯0ã€‚
if(newCapacity-minCapacity<0)ï¼šé‚£è¿™ä¸€æ­¥åœ¨å’±ä»¬ç¬¬ä¸€æ¬¡è¿›æ¥æ—¶ï¼Œå°±ä¼šå‡ºç° 0-10çš„æƒ…å†µå°äº0 è¿›å…¥åˆ¤æ–­ï¼Œå°†10 èµ‹å€¼ç»™newCapacityã€‚ä¹Ÿå°±æ˜¯ç¬¬ä¸€add æ‰©å®¹10 çš„æƒ…å†µã€‚
elementDataArrays.copyOf(elementData,newCapacity); ä½¿ç”¨copyOfè¿›è¡ŒcopyOfï¼Œå°†æ—§æ•°ç»„å†…å®¹ï¼Œæ‹·è´åˆ°æ–°çš„æ•°ç»„ã€‚

## æ€»ç»“
ä¸Šè¿°æè¿°å°±æ˜¯ ç¬¬ä¸€æ®µ ç»“è®ºä¸­çš„ç¬¬äºŒæ¡ï¼Œæ— å‚æ„é€ å™¨çš„æ—¶å€™ï¼Œç¬¬ä¸€æ¬¡æ‰©å®¹10 çš„æµç¨‹ï¼Œé‚£å½“æœ‰å‚æŒ‡å®šå¤§å°çš„æ—¶å€™ï¼Œèµ°çš„è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œå¤§å®¶å¯ä»¥ä¸‹å»è‡ªå·±å°è¯•ä¸€ä¸‹ï¼
å½“æˆ‘ä»¬å»å¢åŠ çš„æ—¶å€™ï¼Œåœ¨growæ–¹æ³•ä¸­æ‰§è¡ŒcopyOfçš„æ–¹æ³•ï¼Œè¿›è¡Œæ‹·è´ï¼Œé‚£å°±å¾ˆæ˜ç™½ä¸ºå•¥è¯´å¢åŠ æ•ˆç‡æ…¢äº†å§ï¼Œè€Œä¸”å®ƒçš„æ‰©å®¹æ–¹æ³•ï¼Œæ¯æ¬¡éƒ½ä¼šæ‰§è¡Œå…ˆä¸è¯´æ‰©ä¸æ‰©å®¹ä»£ç æ¯æ¬¡éƒ½è¦èµ°ä¸€éï¼Œè¿™å°±å¾ˆæ¶å¿ƒäº†~~~~
